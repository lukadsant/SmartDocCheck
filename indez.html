<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Validador Inteligente de Documentos</title>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://unpkg.com/hyperscript.org@0.9.12"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-6">

  <div class="bg-white shadow-lg rounded-xl p-8 max-w-lg w-full space-y-6">
    <h1 class="text-2xl font-bold text-gray-800">Validador Inteligente de Documentos</h1>

    <form 
      id="validate-form"
      class="space-y-4"
      hx-post="http://localhost:8000/validate/"
      hx-trigger="change from:#user_data, change from:#document"
      hx-target="#result"
      hx-encoding="multipart/form-data"
    >
      <div>
        <label class="block text-sm font-medium text-gray-700">Documento (imagem):</label>
        <input 
          type="file" 
          name="document" 
          id="document" 
          class="mt-1 block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500"
          required
        >
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">Dados do usuário (ex: CPF):</label>
        <input 
          type="text" 
          name="user_data" 
          id="user_data" 
          placeholder="088.794.450-73" 
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
          required
        >
      </div>
    </form>

    <!-- Mensagem de status -->
    <div id="status-message" class="text-center font-semibold text-lg"></div>

    <!-- Collapse com resultado técnico -->
    <details class="bg-gray-50 p-4 rounded-md border text-gray-700">
      <summary class="cursor-pointer font-medium text-gray-600">Ver detalhes técnicos da validação</summary>
      <div id="result" class="mt-2 space-y-2">
        <em>Aguardando submissão...</em>
      </div>
    </details>

  </div>

  <script>
    document.body.addEventListener('htmx:afterOnLoad', function(evt) {
      const response = evt.detail.xhr.response;
      try {
        const data = JSON.parse(response);
        const statusDiv = document.getElementById('status-message');
        if (data.validated) {
          statusDiv.textContent = "✅ Documento validado com sucesso!";
          statusDiv.className = "text-green-600 font-semibold text-lg";
        } else {
          statusDiv.textContent = "❌ Falha na validação do documento.";
          statusDiv.className = "text-red-600 font-semibold text-lg";
        }
      } catch (err) {
        console.error('Erro ao interpretar resposta JSON:', err);
      }
    });
  </script>

</body>
</html>
